function loadWidget(t){let{waifuPath:a,apiPath:o,cdnPath:i}=t,n=!1,s;if("string"==typeof i)n=!0,i.endsWith("/")||(i+="/");else{if("string"!=typeof o)return void console.error("Invalid initWidget argument!");o.endsWith("/")||(o+="/")}function l(e){return Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:e}localStorage.removeItem("waifu-display"),sessionStorage.removeItem("waifu-text"),document.body.insertAdjacentHTML("beforeend",`<div id="waifu">
			<div id="waifu-tips"></div>
			<canvas id="live2d" width="800" height="800"></canvas>
			<div id="waifu-tool">
				<span class="fa fa-lg fa-comment"></span>
				<span class="fa fa-lg fa-paper-plane"></span>
				<span class="fa fa-lg fa-user-circle"></span>
				<span class="fa fa-lg fa-street-view"></span>
				<span class="fa fa-lg fa-camera-retro"></span>
				<span class="fa fa-lg fa-info-circle"></span>
				<span class="fa fa-lg fa-times"></span>
			</div>
		</div>`),setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0);let e=!1,d,r,c=["好久不見，日子過得好快呢……","大壞蛋！你都多久沒理人家了呀，嚶嚶嚶～","嗨～快來逗我玩吧！","拿小拳拳錘你胸口！","記得把小家加入 Adblock 白名單哦！"];var u;window.addEventListener("mousemove",()=>e=!0),window.addEventListener("keydown",()=>e=!0),setInterval(()=>{d=e?(e=!1,clearInterval(d),null):d||setInterval(()=>{f(l(c),6e3,9)},2e4)},1e3),document.querySelector("#waifu-tool .fa-comment").addEventListener("click",m),document.querySelector("#waifu-tool .fa-paper-plane").addEventListener("click",()=>{var e;window.Asteroids?(window.ASTEROIDSPLAYERS||(window.ASTEROIDSPLAYERS=[]),window.ASTEROIDSPLAYERS.push(new Asteroids)):((e=document.createElement("script")).src="https://cdn.jsdelivr.net/gh/stevenjoezhang/asteroids/asteroids.js",document.head.appendChild(e))}),document.querySelector("#waifu-tool .fa-user-circle").addEventListener("click",v),document.querySelector("#waifu-tool .fa-street-view").addEventListener("click",w),document.querySelector("#waifu-tool .fa-camera-retro").addEventListener("click",()=>{f("照好了嘛，是不是很可愛呢？",6e3,9),Live2D.captureName="photo.png",Live2D.captureFrame=!0}),document.querySelector("#waifu-tool .fa-info-circle").addEventListener("click",()=>{open("https://github.com/stevenjoezhang/live2d-widget")}),document.querySelector("#waifu-tool .fa-times").addEventListener("click",()=>{localStorage.setItem("waifu-display",Date.now()),f("願你有一天能與重要的人重逢。",2e3,11),document.getElementById("waifu").style.bottom="-500px",setTimeout(()=>{document.getElementById("waifu").style.display="none",document.getElementById("waifu-toggle").classList.add("waifu-toggle-active")},3e3)}),t=()=>{},console.log("%c",t),t.toString=()=>{f("哈哈，你打開了控制台，是想要看看我的小秘密嗎？",6e3,9)},window.addEventListener("copy",()=>{f("你都複製了些什麼呀，轉載要記得加上出處哦！",6e3,9)}),window.addEventListener("visibilitychange",()=>{document.hidden||f("哇，你終於回來了～",6e3,9)});{let e;f(e="/"===location.pathname?5<(u=(new Date).getHours())&&u<=7?"早上好！一日之計在於晨，美好的一天就要開始了。":7<u&&u<=11?"上午好！工作順利嘛，不要久坐，多起來走動走動哦！":11<u&&u<=13?"中午了，工作了一個上午，現在是午餐時間！":13<u&&u<=17?"午後很容易犯困呢，今天的運動目標完成了嗎？":17<u&&u<=19?"傍晚了！窗外夕陽的景色很美麗呢，最美不過夕陽紅～":19<u&&u<=21?"晚上好，今天過得怎麼樣？":21<u&&u<=23?["已經這麼晚了呀，早點休息吧，晚安～","深夜時要愛護眼睛呀！"]:"你是夜貓子呀？這麼晚還不睡覺，明天起的來嘛？":""===document.referrer||(t=(u=new URL(document.referrer)).hostname.split(".")[1],location.hostname===u.hostname)?`歡迎閱讀<span>「${document.title.split(" - ")[0]}」</span>`:"baidu"===t?`Hello！來自 百度搜索 的朋友<br>你是搜索 <span>${u.search.split("&wd=")[1].split("&")[0]}</span> 找到的我嗎？ `:"so"===t?`Hello！來自 360搜索 的朋友<br>你是搜索 <span>${u.search.split("&q=")[1].split("&")[0]}</span> 找到的我嗎？ `:"google"===t?`Hello！來自 谷歌搜索 的朋友<br>歡迎閱讀<span>「${document.title.split(" - ")[0]}」</span>`:`Hello！來自 <span>${u.hostname}</span> 的朋友`,7e3,8)}function m(){fetch("https://v1.hitokoto.cn").then(e=>e.json()).then(e=>{let t=`這句一言來自 <span>「${e.from}」</span>，是 <span>${e.creator}</span> 在 hitokoto.cn 投稿的。 `;f(e.hitokoto,6e3,9),setTimeout(()=>{f(t,4e3,9)},6e3)})}function f(t,a,o){if(t&&!(sessionStorage.getItem("waifu-text")&&sessionStorage.getItem("waifu-text")>o)){r&&(clearTimeout(r),r=null),t=l(t),sessionStorage.setItem("waifu-text",o);let e=document.getElementById("waifu-tips");e.innerHTML=t,e.classList.add("waifu-tips-active"),r=setTimeout(()=>{sessionStorage.removeItem("waifu-text"),e.classList.remove("waifu-tips-active")},a)}}{let e=localStorage.getItem("modelId"),t=localStorage.getItem("modelTexturesId");null===e&&(e=1,t=53),p(e,t),fetch(a).then(e=>e.json()).then(o=>{window.addEventListener("mouseover",e=>{for(var{selector:t,text:a}of o.mouseover)if(e.target.matches(t))return void f(a=(a=l(a)).replace("{text}",e.target.innerText),4e3,8)}),window.addEventListener("click",e=>{for(var{selector:t,text:a}of o.click)if(e.target.matches(t))return void f(a=(a=l(a)).replace("{text}",e.target.innerText),4e3,8)}),o.seasons.forEach(({date:e,text:t})=>{var a=new Date,o=e.split("-")[0],e=e.split("-")[1]||o;o.split("/")[0]<=a.getMonth()+1&&a.getMonth()+1<=e.split("/")[0]&&o.split("/")[1]<=a.getDate()&&a.getDate()<=e.split("/")[1]&&(t=(t=l(t)).replace("{year}",a.getFullYear()),c.push(t))})})}async function g(){var e=await fetch(i+"model_list.json");s=await e.json()}async function p(e,t,a){localStorage.setItem("modelId",e),localStorage.setItem("modelTexturesId",t),f(a,4e3,10),n?(s||await g(),a=l(s.models[e]),loadlive2d("live2d",i+`model/${a}/index.json`)):(loadlive2d("live2d",o+`get/?id=${e}-`+t),console.log(`Live2D 模型 ${e}-${t} 加載完成`))}async function w(){let t=localStorage.getItem("modelId"),a=localStorage.getItem("modelTexturesId");var e;n?(s||await g(),e=l(s.models[t]),loadlive2d("live2d",i+`model/${e}/index.json`),f("我的新衣服好看嘛？",4e3,10)):fetch(`${o}rand_textures/?id=${t}-`+a).then(e=>e.json()).then(e=>{1!==e.textures.id||1!==a&&0!==a?p(t,e.textures.id,"我的新衣服好看嘛？"):f("我還沒有其他衣服呢！",4e3,10)})}async function v(){let e=localStorage.getItem("modelId");var t;n?(s||await g(),p(t=++e>=s.models.length?0:e,0,s.messages[t])):fetch(o+"switch/?id="+e).then(e=>e.json()).then(e=>{p(e.model.id,0,e.model.message)})}}function initWidget(e,t){"string"==typeof e&&(e={waifuPath:e,apiPath:t}),document.body.insertAdjacentHTML("beforeend",`<div id="waifu-toggle">
			<span>看板娘</span>
		</div>`);let a=document.getElementById("waifu-toggle");a.addEventListener("click",()=>{a.classList.remove("waifu-toggle-active"),a.getAttribute("first-time")?(loadWidget(e),a.removeAttribute("first-time")):(localStorage.removeItem("waifu-display"),document.getElementById("waifu").style.display="",setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0))}),localStorage.getItem("waifu-display")&&Date.now()-localStorage.getItem("waifu-display")<=864e5?(a.setAttribute("first-time",!0),setTimeout(()=>{a.classList.add("waifu-toggle-active")},0)):loadWidget(e)}